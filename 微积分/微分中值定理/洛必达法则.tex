\section{洛必达法则}
如果当\(x \to a\)（或\(x \to \infty\)）时，
\(f\)与\(g\)这两个函数都趋于零或都趋于无穷大，
那么极限\(\lim\frac{f(x)}{g(x)}\)可能存在，也可能不存在.
通常把这种极限叫做\DefineConcept{未定式}（indeterminate form），
并简记为\(\frac{0}{0}\)或\(\frac{\infty}{\infty}\).
对于这类极限，即是它存在也不能用“商的极限等于极限的商”这一法则.
下面我们将根据柯西中值定理来推出求这类极限的一种简便且重要的方法.

我们着重讨论\(x \to a^+\)时的未定式\(\frac{0}{0}\)的情形，关于这情形有以下定理：
\begin{theorem}\label{theorem:微分中值定理.洛必达法则1}
%@see: 《高等数学（第六版 上册）》 P135 定理1
%@see: 《高等数学（第六版 上册）》 P136 定理2
%@see: 《数学分析教程（第3版 上册）》（史济怀） P173 定理3.6.1
%@see: 《数学分析（第二版 上册）》（陈纪修） P185 定理5.2.1（L'Hospital法则）
%@see: 《数学分析简明教程（第二版 下册）》（邓东皋、尹小玲） P133 定理5.6
%@see: 《数学分析简明教程（第二版 下册）》（邓东皋、尹小玲） P134 定理5.7
%@see: 《数学分析简明教程（第二版 下册）》（邓东皋、尹小玲） P134 定理5.8
设函数\(f\colon(a,b)\to\mathbb{R}\)和\(g\colon(a,b)\to\mathbb{R}\)都在\((a,b)\)内可导.
如果\begin{itemize}
	\item \(\lim_{x \to a^+} f(x) = \lim_{x \to a^+} g(x) = 0\)，
	或\(\lim_{x \to a^+} g(x) = \infty\)；
	\item \((\forall x \in (a,b))[g'(x) \neq 0]\)；
	\item \(\lim_{x \to a^+} \frac{f'(x)}{g'(x)}\)存在且有限，
	或\(\lim_{x \to a^+} \frac{f'(x)}{g'(x)} = \infty\)，
\end{itemize}
那么\[
	\lim_{x \to a^+} \frac{f(x)}{g(x)}
	= \lim_{x \to a^+} \frac{f'(x)}{g'(x)}.
\]
\begin{proof}
假设\(\lim_{x \to a^+} f(x) = \lim_{x \to a^+} g(x) = 0\)，
且\(\lim_{x \to a^+} \frac{f'(x)}{g'(x)}\)存在且有限.
由于函数在点\(x=a\)的值与当\(x \to a^+\)时的极限无关，
因此可以补充定义：\[
	f(a) = g(a) = 0,
\]
使得\(f\)和\(g\)在区间\([a,b)\)上连续.
取\(c\in(a,b)\)，
则经补充定义后的函数\(f\)和\(g\)在\([a,c]\subset[a,b)\)上
满足\hyperref[theorem:微分中值定理.柯西中值定理]{柯西中值定理}的条件，
因而对于任意\(x\in(a,c)\)，存在\(\xi\in(a,c)\)，满足\[
	\frac{f(x)}{g(x)}
	= \frac{f(x)-f(a)}{g(x)-g(a)}
	= \frac{f'(\xi)}{g'(\xi)}.
\]
当\(x \to a^+\)时显然有\(\xi \to a^+\)，
于是\[
	\lim_{x \to a^+} \frac{f(x)}{g(x)}
	= \lim_{\xi \to a^+} \frac{f'(\xi)}{g'(\xi)}
	= \lim_{x \to a^+} \frac{f'(x)}{g'(x)}.
\]

假设\(\lim_{x \to a^+} g(x) = \infty\)，
且\(\lim_{x \to a^+} \frac{f'(x)}{g'(x)} = A\)存在且有限.
取\(c\in(a,b)\)，
则当\(x \neq c\)时，商式\(\frac{f(x)}{g(x)}\)可以改写为\begin{align*}
	\frac{f(x)}{g(x)}
	&= \frac{f(x) - f(c) + f(c)}{g(x)}
	= \frac{f(x) - f(c)}{g(x)} + \frac{f(c)}{g(x)} \\
	&= \frac{g(x) - g(c)}{g(x)} \cdot \frac{f(x) - f(c)}{g(x) - g(c)} + \frac{f(c)}{g(x)} \\
	&= \left[1 - \frac{g(c)}{g(x)}\right] \frac{f(x) - f(c)}{g(x) - g(c)} + \frac{f(c)}{g(x)}.
\end{align*}
于是\begin{align*}
	\abs{\frac{f(x)}{g(x)} - A}
	&= \abs{
		\left[1 - \frac{g(c)}{g(x)}\right] \frac{f(x) - f(c)}{g(x) - g(c)}
		+ \frac{f(c)}{g(x)} - A
	} \\
	&= \abs{
		\left[1 - \frac{g(c)}{g(x)}\right]
		\left[\frac{f(x) - f(c)}{g(x) - g(c)} - A\right]
		+ \left[1 - \frac{g(c)}{g(x)}\right] A
		+ \frac{f(c)}{g(x)} - A
	} \\
	&= \abs{
		\left[1 - \frac{g(c)}{g(x)}\right]
		\left[\frac{f(x) - f(c)}{g(x) - g(c)} - A\right]
		+ \frac{f(c) - A g(c)}{g(x)}
	} \\
	&\leq \abs{1 - \frac{g(c)}{g(x)}}
	\abs{\frac{f(x) - f(c)}{g(x) - g(c)} - A}
	+ \abs{\frac{f(c) - A g(c)}{g(x)}}.
\end{align*}
因为\(\lim_{x \to a^+} \frac{f'(x)}{g'(x)} = A\)，
所以对于\(\forall\epsilon>0\)，
\(\exists\rho\in(0,b-a)\)，
当\(0<x-a<\rho\)时，
成立\[
	\abs{\frac{f'(x)}{g'(x)} - A} < \epsilon.
\]
取\(c=a+\rho\)，
由\hyperref[theorem:微分中值定理.柯西中值定理]{柯西中值定理}，
对于\(\forall x \in (a,c)\)，
\(\exists\xi\in(x,c)\subset(a,b)\)，
满足\[
	\frac{f(x) - f(c)}{g(x) - g(c)} = \frac{f'(\xi)}{g'(\xi)}.
\]
于是得到\[
	\abs{\frac{f(x) - f(c)}{g(x) - g(c)} - A}
	= \abs{\frac{f'(\xi)}{g'(\xi)} - A}
	< \epsilon.
\]
又因为\(\lim_{x \to a^+} g(x) = \infty\)，
所以\[
	\lim_{x \to a^+} \abs{1 - \frac{g(c)}{g(x)}} = 1,
	\qquad
	\lim_{x \to a^+} \abs{\frac{f(c) - A g(c)}{g(x)}} = 0,
\]
也就是说\(\exists\delta\in(0,\rho)\)，
当\(0<x-a<\delta\)时，
成立\[
	\abs{1-\frac{g(c)}{g(x)}} < 2, \qquad
	\abs{\frac{f(c) - A g(c)}{g(x)}} < \epsilon.
\]
综上所述，对于\(\forall\epsilon>0\)，
\(\exists\delta>0\)，
当\(0<x-a<\delta\)时，
成立\begin{align*}
	\abs{\frac{f(x)}{g(x)} - A}
	&\leq \abs{1 - \frac{g(c)}{g(x)}}
	\abs{\frac{f(x) - f(c)}{g(x) - g(c)} - A}
	+ \abs{\frac{f(c) - A g(c)}{g(x)}} \\
	&< 2\epsilon + \epsilon = 3\epsilon,
\end{align*}
由定义有\[
	\lim_{x \to a^+} \frac{f(x)}{g(x)}
	= \lim_{x \to a^+} \frac{f'(x)}{g'(x)}
	= A.
	\qedhere
\]
\end{proof}
\end{theorem}
像这样，在一定条件下，
通过分子分母分别求导再求极限来确定未定式的值的方法，
称为\DefineConcept{洛必达法则}（L'Hospital's rule）.

如果\(\frac{f'(x)}{g'(x)}\)当\(x \to a^+\)时仍属\(\frac{0}{0}\)型，
且这时\(f'(x)\)和\(g'(x)\)能满足定理中\(f(x)\)和\(g(x)\)所要满足的条件，
那么可以继续施用洛必达法则先确定\(\lim_{x \to a^+} \frac{f'(x)}{g'(x)}\)，
从而确定\(\lim_{x \to a^+} \frac{f(x)}{g(x)}\)，即\[
	\lim_{x \to a^+} \frac{f(x)}{g(x)}
	= \lim_{x \to a^+} \frac{f'(x)}{g'(x)}
	= \lim_{x \to a^+} \frac{f''(x)}{g''(x)};
\]
且可以此类推.

洛必达法则只是未定式极限存在的充分不必要条件.
例如，对于极限\[
	\lim_{x\to\infty} \frac{x+\sin x}{x},
\]
易见\[
	\lim_{x\to\infty} (x+\sin x)
	= \lim_{x\to\infty} x
	= \infty,
	\qquad
	(x+\sin x)' = 1+\cos x, \qquad
	x' = 1.
\]
虽然极限\[
	\lim_{x\to\infty}\frac{(x+\sin x)'}{x'} = \lim_{x\to\infty}(1+\cos x)
\]不存在，
但原极限存在：\[
	\lim_{x\to\infty} \frac{x+\sin x}{x}
	= 1 + \lim_{x\to\infty} \frac{\sin x}{x}
	= 1 + 0 = 1.
\]

\begin{example}
%@see: 《高等数学（第六版 上册）》 P136 例1
求\(\lim_{x\to0} \frac{\sin ax}{\sin bx}\ (b \neq 0)\).
\begin{solution}
\(\lim_{x\to0} \frac{\sin ax}{\sin bx}
= \lim_{x\to0} \frac{a \cos ax}{b \cos bx}
= \frac{a}{b}\).
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P136 例2
求\(\lim_{x\to1} \frac{x^3-3x+2}{x^3-x^2-x+1}\).
\begin{solution}
\(\lim_{x\to1} \frac{x^3-3x+2}{x^3-x^2-x+1}
= \lim_{x\to1} \frac{3x^2-3}{3x^2-2x-1}
= \lim_{x\to1} \frac{6x}{6x-2}
= \frac32\).
\end{solution}
\end{example}

\begin{remark}
在上例中，\(\lim_{x\to1} \frac{6x}{6x-2}\)已经不是未定式，
不能再对它应用洛必达法则，否则会导致错误结果.
以后在使用洛必达法则时，一定要经常注意极限是否还是未定式，
如果不是未定式，就不能应用洛必达法则.
\end{remark}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P136 例3
求\(\lim_{x\to0} \frac{x-\sin x}{x^3}\).
\begin{solution}
\(\lim_{x\to0} \frac{x-\sin x}{x^3}
= \lim_{x\to0} \frac{1-\cos x}{3x^2}
= \lim_{x\to0} \frac{\sin x}{6x}
= \frac16\).
\end{solution}
\end{example}

\begin{example}
求\(\lim_{x\to\pi} (\csc x+\cot x)\).
\begin{solution}
\(\lim_{x\to\pi} (\csc x+\cot x)
= \lim_{x\to\pi} \frac{1+\cos x}{\sin x}
= \lim_{x\to\pi} \frac{-\sin x}{\cos x}
= 0\).
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P136 例4
求\(\lim_{x\to+\infty} \frac{\frac{\pi}{2} - \arctan x}{\frac{1}{x}}\).
\begin{solution}
\(\lim_{x\to+\infty} \frac{\frac{\pi}{2} - \arctan x}{\frac{1}{x}}
= \lim_{x\to+\infty} \frac{-\frac{1}{1+x^2}}{-\frac{1}{x^2}}
= \lim_{x\to+\infty} \frac{x^2}{1+x^2} = 1\).
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P136 例5
求\(\lim_{x\to+\infty} \frac{\ln x}{x^n}\ (n>0)\).
\begin{solution}
\(\lim_{x\to+\infty} \frac{\ln x}{x^n}
= \lim_{x\to+\infty} \frac{\frac{1}{x}}{n x^{n-1}}
= \lim_{x\to+\infty} \frac{1}{n x^n} = 0\).
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P137 例6
求\(\lim_{x\to+\infty} \frac{x^n}{e^{\lambda x}}\ (n>0,\lambda>0)\).
\begin{solution}
相继应用洛必达法则\(n\)次，
得\begin{align*}
	\lim_{x\to+\infty} \frac{x^n}{e^{\lambda x}}
	&= \lim_{x\to+\infty} \frac{n x^{n-1}}{\lambda e^{\lambda x}}
	= \lim_{x\to+\infty} \frac{n(n-1) x^{n-2}}{\lambda^2 e^{\lambda x}} \\
	&= \dotsb = \lim_{x\to+\infty} \frac{n!}{\lambda^n e^{\lambda x}}
	= 0.
\end{align*}
\end{solution}
\end{example}

其他还有一些\(0 \cdot \infty\)、\(\infty - \infty\)、\(0^0\)、\(1^\infty\)、\(\infty^0\)型的未定式，也可通过\(\frac{0}{0}\)或\(\frac{\infty}{\infty}\)型的未定式来计算.

形如\(\infty - \infty\)的未定式，
通分为\(\frac{0}{0}\)或\(\frac{\infty}{\infty}\)型.
形如\(0 \cdot \infty\)的未定式，
将其中一个因子取倒数作为分母，
化为\(\frac{0}{0}\)或\(\frac{\infty}{\infty}\)型.
形如\(0^0\)、\(1^\infty\)、\(\infty^0\)的未定式，
先取对数，化为\(0 \cdot \infty\)型.

\begin{example}\label{example:微分中值定理.洛必达法则.零乘无穷大型1}
%@see: 《高等数学（第六版 上册）》 P137 例7
求\(\lim_{x\to0^+} x^n \ln x\ (n > 0)\).
\begin{solution}
这是未定式\(0\cdot\infty\).
因为\(x^n \ln x = \frac{\ln x}{\frac{1}{x^n}}\)，
当\(x\to0^+\)时，上式右端是未定式\(\frac{\infty}{\infty}\)，
应用洛必达法则，
得\(\lim_{x\to0^+} x^n \ln x
= \lim_{x\to0^+} \frac{\ln x}{x^{-n}}
= \lim_{x\to0^+} \frac{x^{-1}}{-nx^{-n-1}}
= \lim_{x\to0^+} \frac{-x^n}{n}
= 0\).
\end{solution}
\end{example}

\begin{example}
%@see: 《高等数学（第六版 上册）》 P138 例8
求\(\lim_{x\to\frac\pi2} (\sec x-\tan x)\).
\begin{solution}
这是未定式\(\infty-\infty\).
因为\(\sec x-\tan x = \frac{1-\sin x}{\cos x}\)，
当\(x\to\frac\pi2\)时，上式右边是未定式\(\frac00\)，
应用洛必达法则，
得\(\lim_{x\to\frac\pi2} (\sec x-\tan x)
= \lim_{x\to\frac\pi2} \frac{1-\sin x}{\cos x}
= \lim_{x\to\frac\pi2} \frac{\cos x}{-\sin x}
= 0\).
\end{solution}
\end{example}

\begin{example}
求\(\lim_{x\to-\frac\pi2} (\sec x+\tan x)\).
\begin{solution}
\(\lim_{x\to-\frac\pi2} (\sec x+\tan x)
= \lim_{x\to-\frac\pi2} \frac{1+\sin x}{\cos x}
= \lim_{x\to-\frac\pi2} \frac{\cos x}{-\sin x}
= 0\).
\end{solution}
\end{example}

\begin{example}\label{example:微分中值定理.洛必达法则.零次方零型1}
%@see: 《高等数学（第六版 上册）》 P138 例9
求\(\lim_{x\to0^+} x^x\).
\begin{solution}
这是未定式\(0^0\).
设\(y = x^x\)，取对数得\(\ln y = x \ln x\).
当\(x\to0^+\)时，上式右端是未定式\(0\cdot\infty\).
应用\cref{example:微分中值定理.洛必达法则.零乘无穷大型1} 的结果，
得\[
	\lim_{x\to0^+} \ln y
	= \lim_{x\to0^+} (x \ln x) = 0.
\]
因为\(y = e^{\ln y}\)，
而\(\lim_{x\to0^+} y
= \lim_{x\to0^+} e^{\ln y}
= e^{\lim_{x\to0^+} \ln y}\)，
所以\[
	\lim_{x\to0^+} x^x
	= \lim_{x\to0^+} y
	= e^0
	= 1.
\]
\end{solution}
\end{example}

\begin{example}\label{example:微分中值定理.洛必达法则.零乘无穷大型2}
求\(\lim_{x\to+\infty} x p^x\ (0<p<1)\).
\begin{solution}
这是未定式\(0\cdot\infty\).
因为\(x p^x =  \frac{x}{(1/p)^x}\)，
当\(x\to+\infty\)时，上式右端是未定式\(\frac{\infty}{\infty}\)，
应用洛必达法则，
得\[
	\lim_{x\to+\infty} x p^x
	= \lim_{x\to+\infty} \frac{x}{(1/p)^x}
	= \lim_{x\to+\infty} \frac{1}{(1/p)^x \ln(1/p)}
	= \lim_{x\to+\infty} \frac{p^x}{\ln(1/p)}
	= 0.
\]
\end{solution}
\end{example}

洛必达法则是求未定式的一种有效方法，但最好能与其他求极限的方法结合使用.
例如能化简时应尽量先化简，可以应用等价无穷小替代或重要极限时应尽可能应用，这样可以使运算简便.

\begin{example}
%@see: 《高等数学（第六版 上册）》 P138 例10
求\(\lim_{x\to0} \frac{\tan x - x}{x^2 \sin x}\).
\begin{solution}
如果直接用洛必达法则，那么分母的导数（尤其是高阶导数）比较复杂.
如果作一个等价无穷小替代，那么运算就方便得多：
\begin{align*}
	\lim_{x\to0} \frac{\tan x - x}{x^2 \sin x}
	&= \lim_{x\to0} \frac{\tan x - x}{x^3} \cdot \frac{x}{\sin x}
	= \lim_{x\to0} \frac{\tan x - x}{x^3} \\
	&= \lim_{x\to0} \frac{\sec^2 x - 1}{3x^2} \\
	&= \lim_{x\to0} \frac{2\sec^2 x \tan x}{6x} \\
	&= \frac13 \lim_{x\to0} \frac{\tan x}{x} = \frac13.
\end{align*}
\end{solution}
\end{example}

\begin{example}
求\(\lim_{x\to0} \frac{a^{x^2}-b^{x^2}}{(a^x-b^x)^2}\ (0<a<b)\).
\begin{solution}
这里我们先化简，再利用洛必达法则：\begin{align*}
	\lim_{x\to0} \frac{a^{x^2}-b^{x^2}}{(a^x-b^x)^2}
	&= \lim_{x\to0} \frac{a^{x^2}-b^{x^2}}{x^2}
		\cdot \lim_{x\to0} \left(\frac{x}{a^x-b^x}\right)^2 \\
	&= \lim_{x\to0^+} \frac{a^x-b^x}{x}
		\cdot \lim_{x\to0} \left(\frac{x}{a^x-b^x}\right)^2 \\
	&= \lim_{x\to0} \frac{x}{a^x-b^x} \\
	&= \lim_{x\to0} \frac{1}{a^x \ln a - b^x \ln b}
	= \frac{1}{\ln(a/b)}.
\end{align*}
\end{solution}
\end{example}
