\section{反常积分的审敛法}
反常积分的收敛性，可以通过求被积函数的原函数，然后按定义取极限，根据极限的存在与否来判定.
但在本节中，我们可以建立不通过被积函数的原函数判定反常积分收敛性的判定法.

\subsection{反常积分的重要特性}
%@see: 《数学分析（第二版 上册）》（陈纪修） P362
设函数\(f\colon[a,+\infty)\to\mathbb{R}\).
由\cref{example:定积分.p积分} 可知，
\(\lim_{x\to+\infty} f(x) = 0\)
并不能保证\(\int_a^{+\infty} f(x) \dd{x}\)收敛.
反过来，若\(\int_a^{+\infty} f(x) \dd{x}\)收敛，
能否保证\(\lim_{x\to+\infty} f(x) = 0\)，
或者退一步，至少保证\(f\)在定义域上有界呢？
下面我们用一个例子说明：同样不能！
\begin{example}
%@see: 《数学分析（第二版 上册）》（陈纪修） P362 例8.1.7
设函数\(f\colon[1,+\infty)\to\mathbb{R}\)
满足\[
	f(x) = \left\{ \begin{array}{cl}
		n+1, & n \leq x \leq n+\frac1{n(n+1)^2}, \\
		0, & n+\frac1{n(n+1)^2} < x < n+1,
	\end{array} \right.
	\quad n=1,2,\dotsc.
\]
那么对于任意\(t>1\)，
总可以取自然数\(n\)，
使得\(n \leq t < n+1\).
由于\(f(x)\geq0\)，
所以\[
	\int_1^n f(x) \dd{x}
	\leq \int_1^t f(x) \dd{x}
	\leq \int_1^{n+1} f(x) \dd{x}.
\]
考虑到\[
	\int_k^{k+1} f(x) \dd{x}
	= \int_k^{k+\frac1{k(k+1)^2}} (k+1) \dd{x}
	= (k+1) \cdot \frac1{k(k+1)^2}
	= \frac1{k(k+1)},
	\quad k=1,2,\dotsc,
\]
令\(n\to\infty\)，
得\begin{align*}
	\lim_{n\to\infty} \int_1^n f(x) \dd{x}
	&= \lim_{n\to\infty} \left[
		\int_1^2 f(x) \dd{x}
		+ \int_2^3 f(x) \dd{x}
		+ \dotsb
		+ \int_{n-1}^n f(x) \dd{x}
	\right] \\
	&= \lim_{n\to\infty} \left[
		\frac1{1\cdot2}
		+ \frac1{2\cdot3}
		+ \dotsb
		+ \frac1{(n-1)n}
	\right] \\
	&= \lim_{n\to\infty} \left[
		\left(1-\frac12\right)
		+ \left(\frac12-\frac13\right)
		+ \dotsb
		+ \left(\frac1{n-1}-\frac1n\right)
	\right] \\
	&= \lim_{n\to\infty} \left(1-\frac1n\right)
	= 1.
\end{align*}
同理可得\[
	\lim_{n\to\infty} \int_1^{n+1} f(x) \dd{x} = 1.
\]
利用\hyperref[theorem:数列极限.夹逼准则]{夹逼准则}便知\[
	\int_1^{+\infty} f(x) \dd{x}
	= \lim_{t\to+\infty} \int_1^t f(x) \dd{x}
	= 1,
\]
但是\(f\)显然是无界的.
\end{example}
我们还可以断言，即使\(f\)在\([a,+\infty)\)连续（甚至\(n\)次可微），
也可仿照上例，构造出使\(\int_a^{+\infty} f(x) \dd{x}\)收敛，
而\(f\)在\([a,+\infty)\)无界的例子.

\subsection{柯西极限存在准则}
由于反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛
即为极限\(\lim_{t\to+\infty} \int_a^t f(x) \dd{x}\)存在，
因此对反常积分收敛性的最本质的刻画，
就是极限论中的\hyperref[theorem:极限.函数的柯西极限存在准则]{柯西极限存在准则}，
它可以表述为如下形式：
\begin{theorem}\label{theorem:反常积分.柯西极限存在准则}
%@see: 《数学分析（第二版 上册）》（陈纪修） P370 定理8.2.1（Cauchy收敛原理）
设函数\(f\colon[a,+\infty)\to\mathbb{R}\)，
则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛的充分必要条件是：
对任意给定\(\epsilon>0\)，存在\(X \geq a\)，
使得对任意\(x_1,x_2 \geq X\)，
有\[
	\abs{\int_{x_1}^{x_2} f(t) \dd{t}} < \epsilon.
\]
\end{theorem}

\begin{definition}
%@see: 《数学分析（第二版 上册）》（陈纪修） P370 定义8.2.1
设函数\(f\colon[a,+\infty)\to\mathbb{R}\)在任意有限闭区间上可积.
\begin{itemize}
	\item 如果反常积分\[
		\int_a^{+\infty} \abs{f(x)} \dd{x}
	\]收敛，
	则称“反常积分\(\int_a^{+\infty} f(x) \dd{x}\)~\DefineConcept{绝对收敛}”.

	\item 如果反常积分\[
		\int_a^{+\infty} f(x) \dd{x}
	\]收敛，
	而\[
		\int_a^{+\infty} \abs{f(x)} \dd{x}
	\]不收敛，
	则“反常积分\(\int_a^{+\infty} f(x) \dd{x}\)~\DefineConcept{条件收敛}”.
\end{itemize}
\end{definition}

\begin{theorem}\label{theorem:定积分.绝对收敛的无穷限反常积分必收敛}
%@see: 《高等数学（第六版 上册）》 P264 定理5
%@see: 《数学分析（第二版 上册）》（陈纪修） P370 推论
绝对收敛的反常积分必定收敛.
\begin{proof}
对于任意给定\(\epsilon>0\)，
由于\(\int_a^{+\infty} \abs{f(x)} \dd{x}\)收敛，
所以存在\(X \geq a\)，
使得对任意\(x_1,x_2 \geq X\)，
成立\[
	\int_{x_1}^{x_2} \abs{f(x)} \dd{x} < \epsilon.
\]
利用\cref{theorem:定积分.定积分性质5推论2} 可得\[
	\abs{\int_{x_1}^{x_2} f(x) \dd{x}}
	\leq \int_{x_1}^{x_2} f(x) \dd{x}
	< \epsilon,
\]
再次运用\hyperref[theorem:反常积分.柯西极限存在准则]{柯西极限存在准则}便知
\(\int_a^{+\infty} f(x) \dd{x}\)收敛.
\end{proof}
\end{theorem}

\begin{example}
设反常积分\(\int_1^{+\infty} f^2(x) \dd{x}\)收敛.
证明：反常积分\(\int_1^{+\infty} \frac{f(x)}{x} \dd{x}\)绝对收敛.
\begin{proof}
由\cref{theorem:不等式.基本不等式2} 可知，
在区间\([1,+\infty)\)上有\[
	\abs{\frac{f(x)}{x}}
	= \frac{\abs{f(x)}}{x}
	\leq \frac{1}{2} \left[
		\abs{f(x)}^2 + \frac{1}{x^2}
	\right]
	= \frac{1}{2} f^2(x) + \frac{1}{2x^2}
\]成立，
且\(\int_1^{+\infty} f^2(x) \dd{x}\)和\(\int_1^{+\infty} \frac{1}{x^2} \dd{x}\)都收敛，
故\(\int_1^{+\infty} \abs{\frac{f(x)}{x}} \dd{x}\)收敛.
\end{proof}
\end{example}

\subsection{非负函数的反常积分的审敛法}
\begin{theorem}\label{theorem:定积分.无穷限反常积分的审敛法引理}
%@see: 《高等数学（第六版 上册）》 P261 定理1
%@see: 《数学分析教程 （第3版 下册）》（史济怀） P274 定理16.1.1
设函数\(f\colon[a,+\infty)\to\mathbb{R}\)非负，
则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛的充分必要条件是：
函数\[
	F\colon[a,+\infty)\to\mathbb{R},
	x \mapsto \int_a^x f(t) \dd{t}
\]在\([a,+\infty)\)上有上界.
\begin{proof}
根据\hyperref[definition:定积分.无穷限的反常积分的定义1]{定义}，
反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛，
当且仅当极限\(F(+\infty) = \lim_{x\to+\infty} F(x)\)存在且有限.
由于\(f(x)\geq0\)，
所以\(F(x) = \int_a^x f(t) \dd{t}\)是单调增加的，
于是由\hyperref[theorem:极限.函数的单调有界定理]{单调有界定理}%
和\hyperref[theorem:极限.函数极限的局部有界性]{局部有界性}可知，
极限\(F(+\infty)\)存在且有限的充分必要条件是\(F\)有界.
\end{proof}
\end{theorem}

根据\cref{theorem:定积分.无穷限反常积分的审敛法引理}，
对于非负函数的无穷限的反常积分，有以下的比较审敛原理.
\begin{theorem}[比较审敛原理]\label{theorem:定积分.无穷限反常积分的比较审敛原理}
%@see: 《高等数学（第六版 上册）》 P261 定理2（比较审敛原理）
%@see: 《数学分析（第二版 上册）》（陈纪修） P371 定理8.2.2（比较判别法）
设函数\(f,g\)在区间\([a,+\infty)\)上连续.
\begin{itemize}
	\item 如果\[
		0 \leq f(x) \leq g(x)
		\quad(a \leq x < +\infty),
	\]
	并且\(\int_a^{+\infty} g(x) \dd{x}\)收敛，
	则\(\int_a^{+\infty} f(x) \dd{x}\)也收敛.

	\item 如果\[
		0 \leq g(x) \leq f(x)
		\quad(a \leq x < +\infty),
	\]
	并且\(\int_a^{+\infty} g(x) \dd{x}\)发散，
	则\(\int_a^{+\infty} f(x) \dd{x}\)也发散.
\end{itemize}
\begin{proof}
任意取定\(t \in (a,+\infty)\).

当有\(0 \leq f(x) \leq g(x)\)且\(\int_a^{+\infty} g(x) \dd{x}\)收敛时，
根据\cref{theorem:定积分.定积分性质5推论1}
得\[
	\int_a^t f(x) \dd{x}
	\leq
	\int_a^t g(x) \dd{x}
	\leq
	\int_a^{+\infty} g(x) \dd{x}.
\]
这表明作为积分上限\(t\)的函数\[
	F(t) = \int_a^t f(x) \dd{x}
\]
在区间\([a,+\infty)\)上有上界.
由\cref{theorem:定积分.无穷限反常积分的审敛法引理} 可知，
反常积分\(\int_a^{+\infty} f(x) \dd{x}\)也收敛.
\end{proof}
\end{theorem}

\begin{corollary}[比较审敛原理的极限形式]
%@see: 《数学分析（第二版 上册）》（陈纪修） P371 推论（比较判别法的极限形式）
设函数\(f,g\)在\([a,+\infty)\)上非负，
记\[
	\rho \defeq \lim_{x\to+\infty} \frac{f(x)}{g(x)}.
\]
\begin{itemize}
	\item 若\(0 \leq \rho < +\infty\)，
	则\[
		\text{\(\int_a^{+\infty} g(x) \dd{x}\)收敛}
		\implies
		\text{\(\int_a^{+\infty} f(x) \dd{x}\)收敛}.
	\]
	\item 若\(0 < \rho \leq +\infty\)，
	则\[
		\text{\(\int_a^{+\infty} g(x) \dd{x}\)发散}
		\implies
		\text{\(\int_a^{+\infty} f(x) \dd{x}\)发散}.
	\]
\end{itemize}
\end{corollary}

\begin{theorem}[比较审敛法1]\label{theorem:定积分.无穷限反常积分的比较审敛法}
%@see: 《高等数学（第六版 上册）》 P262 定理3（比较审敛法1）
%@see: 《数学分析（第二版 上册）》（陈纪修） P372 定理8.2.3（Cauchy判别法）
设函数\(f\)在区间\([a,+\infty)\)上非负.
\begin{itemize}
	\item 如果存在常数\(M>0\)及\(p>1\)，使得\[
		f(x) \leq \frac{M}{x^p}
		\quad(a \leq x < +\infty),
	\]
	则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛.
	\item 如果存在常数\(N>0\)，使得\[
		f(x) \geq \frac{N}{x}
		\quad(a \leq x < +\infty),
	\]
	则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)发散.
\end{itemize}
\end{theorem}

\begin{theorem}[比较审敛法2]\label{theorem:定积分.无界函数的反常积分的比较审敛法}
%@see: 《高等数学（第六版 上册）》 P265 定理6（比较审敛法2）
设函数\(f(x)\)在区间\((a,b]\)上连续，
且\(f(x) \geq 0\)，
\(x=a\)为\(f(x)\)的瑕点.
\begin{itemize}
	\item 如果存在常数\(M > 0\)及\(q < 1\)，使得\[
		f(x) \leq \frac{M}{(x-a)^q}
		\quad(a < x \leq b),
	\]
	则反常积分\(\int_a^b f(x) \dd{x}\)收敛.
	\item 如果存在常数\(N > 0\)，使得\[
		f(x) \geq \frac{N}{x - a}
		\quad(a < x \leq b),
	\]
	则反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{itemize}
\end{theorem}

\begin{theorem}[极限审敛法1]\label{theorem:定积分.无穷限反常积分的极限审敛法}
%@see: 《高等数学（第六版 上册）》 P262 定理4（极限审敛法1）
%@see: 《数学分析（第二版 上册）》（陈纪修） P373 推论（Cauchy判别法的极限形式）
设函数\(f\)在区间\([a,+\infty)\)上非负，
记\[
	\rho(k) \defeq \lim_{x\to+\infty} x^k f(x).
\]
\begin{itemize}
	\item 如果存在常数\(k > 1\)，
	使得\(0 \leq \rho(k) < +\infty\)，
	则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛.
	\item 如果存在常数\(k \leq 1\)，
	使得\(0 < \rho(k) \leq +\infty\)，
	则反常积分\(\int_a^{+\infty} f(x) \dd{x}\)发散.
\end{itemize}
\end{theorem}

\begin{theorem}[极限审敛法2]\label{theorem:定积分.无界函数的反常积分的极限审敛法}
%@see: 《高等数学（第六版 上册）》 P265 定理7（极限审敛法2）
设函数\(f(x)\)在区间\((a,b]\)上连续，
且\(f(x) \geq 0\)，
\(x=a\)为\(f(x)\)的瑕点.
\begin{itemize}
	\item 如果存在常数\(q \in (0,1)\)，使得\[
		\lim_{x \to a^+} (x-a)^q f(x)
	\]存在，
	则反常积分\(\int_a^b f(x) \dd{x}\)收敛.
	\item 如果\[
		\lim_{x \to a^+} (x-a) f(x) = d \in (0,+\infty],
	\]
	则反常积分\(\int_a^b f(x) \dd{x}\)发散.
\end{itemize}
\end{theorem}

\begin{example}\label{example:定积分.高斯积分的收敛性}
证明：高斯积分\[
	\int_0^{+\infty} e^{-x^2} \dd{x}
\]收敛.
\begin{proof}
因为在区间\([0,+\infty)\)上被积函数\(f(x) = e^{-x^2}\)连续且恒大于零，
且极限\[
	\lim_{x\to+\infty} x^2 e^{-x^2}
	= \lim_{x\to+\infty} \frac{x^2}{e^{x^2}}
	\xlongequal{u=x^2} \lim_{u\to+\infty} \frac{u}{e^u}
	= \lim_{u\to+\infty} \frac{1}{e^u}
	= 0,
\]
那么根据\cref{theorem:定积分.无穷限反常积分的极限审敛法}，
高斯积分\(\int_0^{+\infty} e^{-x^2} \dd{x}\)收敛.
\end{proof}
\end{example}

\subsection{一般函数的反常积分的审敛法}
\begin{theorem}\label{theorem:反常积分.阿贝尔--狄利克雷审敛法}
%@see: 《数学分析（第二版 上册）》（陈纪修） P374 定理8.2.5
若下列两个条件之一满足，
则反常积分\(\int_a^{+\infty} f(x) ~ g(x) \dd{x}\)收敛：\begin{itemize}
	\item {\bf 阿贝尔条件}
	反常积分\(\int_a^{+\infty} f(x) \dd{x}\)收敛，
	函数\(g\)在\([a,+\infty)\)上单调有界.

	\item {\bf 狄利克雷条件}
	函数\(x \mapsto \int_a^x f(t) \dd{t}\)在\([a,+\infty)\)上有界，
	函数\(g\)在\([a,+\infty)\)上单调且\(\lim_{x\to+\infty} g(x) = 0\).
\end{itemize}
%TODO proof
%\cref{theorem:定积分.积分中值定理2}
\end{theorem}

\begin{example}
%@see: 《数学分析（第二版 上册）》（陈纪修） P375 例8.2.4
证明：反常积分\(\int_1^{+\infty} \frac{\sin x}{x} \dd{x}\)条件收敛.
% 与狄利克雷积分\(\int_0^{+\infty} \frac{\sin x}{x} \dd{x}\)的积分下限不同！
\begin{proof}
显然函数\(x \mapsto \int_1^x \sin t \dd{t}\)有界，
函数\(x \mapsto \frac1x\)在\([1,+\infty)\)上单调减少且\(\lim_{x\to+\infty} \frac1x = 0\)，
满足\hyperref[theorem:反常积分.阿贝尔--狄利克雷审敛法]{狄利克雷条件}，
因此反常积分\(\int_1^{+\infty} \frac{\sin x}{x} \dd{x}\)收敛.

但是在\([1,+\infty)\)上，有\[
	\abs{\frac{\sin x}{x}}
	\geq \frac{\sin^2x}{x}
	= \frac1{2x} - \frac{\cos2x}{2x},
\]
因反常积分\(\int_1^{+\infty} \frac{\cos2x}{2x} \dd{x}\)收敛
（仿照上面对反常积分\(\int_1^{+\infty} \frac{\sin x}{x} \dd{x}\)的讨论），
而反常积分\(\int_1^{+\infty} \frac{\dd{x}}{2x}\)发散，
所以反常积分\(\int_1^{+\infty} \frac{\sin^2x}{x} \dd{x}\)发散.
再由\hyperref[theorem:定积分.无穷限反常积分的比较审敛原理]{比较审敛原理}可知，
\(\int_1^{+\infty} \abs{\frac{\sin x}{x}} \dd{x}\)发散.

综上所述，\(\int_1^{+\infty} \frac{\sin x}{x} \dd{x}\)条件收敛.
\end{proof}
\end{example}
\begin{example}
%@see: 《数学分析（第二版 上册）》（陈纪修） P375 例8.2.5
证明：反常积分\(\int_1^{+\infty} \frac{\sin x \arctan x}{x} \dd{x}\)条件收敛.
\begin{proof}
由上例可知\(\int_1^{+\infty} \frac{\sin x}{x} \dd{x}\)收敛，
而函数\(x \mapsto \arctan x\)在\([1,+\infty)\)上单调有界，
满足\hyperref[theorem:反常积分.阿贝尔--狄利克雷审敛法]{阿贝尔条件}，
因此\(\int_1^{+\infty} \frac{\sin x \arctan x}{x} \dd{x}\)收敛.

当\(\sqrt3 \leq x < +\infty\)时，有\[
	\abs{\frac{\sin x \arctan x}{x}}
	\geq \abs{\frac{\sin x}{x}}.
\]
因为\(\int_1^{+\infty} \abs{\frac{\sin x}{x}} \dd{x}\)发散，
所以由\hyperref[theorem:定积分.无穷限反常积分的比较审敛原理]{比较审敛原理}可知，
\(\int_1^{+\infty} \abs{\frac{\sin x \arctan x}{x}} \dd{x}\)发散.

综上所述，\(\int_1^{+\infty} \frac{\sin x \arctan x}{x} \dd{x}\)条件收敛.
\end{proof}
\end{example}
